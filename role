// Simple MongoDB permission check and fix
const user = "x";
const dbName = "db1";
const neededRoles = ["readWrite"]; // Add other roles as needed

try {
  const userData = db.getSiblingDB("admin").getUser(user);
  const currentRoles = userData.roles.filter(r => r.db === dbName).map(r => r.role);
  
  const missing = neededRoles.filter(role => !currentRoles.includes(role));
  
  if (missing.length > 0) {
    print(`Adding missing roles: ${missing.join(', ')}`);
    db.getSiblingDB("admin").grantRolesToUser(
      user, 
      missing.map(role => ({ role, db: dbName }))
    );
    print("Roles updated successfully");
  } else {
    print("User already has all required roles");
  }
} catch (e) {
  print(`Error: ${e.message}`);
}
