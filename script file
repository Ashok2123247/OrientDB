#!/bin/bash
HTML=$(mongo --quiet --eval "print('<html><body><h2>MongoDB Slow Queries</h2><pre>' + JSON.stringify(db.currentOp({'active':true,'secs_running':{'$gt':5}}), null, 2) + '</pre></body></html>')")
[ -n "$HTML" ] && echo "$HTML" | mail -a "Content-type: text/html" -s "MongoDB Slow Query Alert" admin@example.com



#!/bin/bash
HTML=$(mongo --quiet --eval "
var ops = db.currentOp({'active':true,'secs_running':{'$gt':5}}).toArray();
var html = '<html><head><style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { color: #d32f2f; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
  tr:nth-child(even) { background-color: #f9f9f9; }
</style></head>
<body>
<h2>MongoDB Slow Query Alert</h2>
<table>
  <tr><th>OPID</th><th>Duration (s)</th><th>Namespace</th><th>Operation</th><th>Client</th></tr>';
ops.forEach(function(op) {
  html += '<tr>' +
    '<td>' + (op.opid || '') + '</td>' +
    '<td>' + (op.secs_running || 0).toFixed(2) + '</td>' +
    '<td>' + (op.ns || '') + '</td>' +
    '<td>' + (op.op || '') + '</td>' +
    '<td>' + (op.client || '') + '</td>' +
    '</tr>';
});
html += '</table></body></html>';
print(html);
")

[ -n "$HTML" ] && echo "$HTML" | mail -a "Content-type: text/html" -s "MongoDB Slow Query Alert" admin@example.com


