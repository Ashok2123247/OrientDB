#!/bin/bash

DB_NAME="your_db_name"
OLD_COLLECTION="oldCollection"
NEW_COLLECTION="newCollection"

mongosh <<EOF
use $DB_NAME

// Get all unique command combinations from old collection
const oldDocs = db.$OLD_COLLECTION.find({}, {cmd: 1, remote: 1, db: 1, fields: 1, _id: 0}).toArray();

let deletedCount = 0;

oldDocs.forEach(doc => {
  const result = db.$NEW_COLLECTION.deleteMany({
    cmd: doc.cmd,
    remote: doc.remote,
    db: doc.db,
    fields: doc.fields
  });
  if (result.deletedCount > 0) {
    print("Removed", result.deletedCount, "matching doc(s):", JSON.stringify(doc));
    deletedCount += result.deletedCount;
  }
});

print("Total deleted from $NEW_COLLECTION:", deletedCount);
EOF
