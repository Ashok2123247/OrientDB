DECLARE @dbList NVARCHAR(MAX) = 'UserDB1,UserDB2,UserDB3'  -- Replace with your database names
DECLARE @sql NVARCHAR(MAX)

-- Print current recovery models BEFORE change
PRINT '=== BEFORE CHANGE ==='
SELECT name AS [Database], recovery_model_desc AS [Recovery Model]
FROM sys.databases
WHERE name IN (
    SELECT TRIM(value)
    FROM STRING_SPLIT(@dbList, ',')
)
AND name NOT IN ('master', 'model', 'msdb', 'tempdb')

-- Generate ALTER DATABASE statements for those in FULL recovery
SELECT @sql = STRING_AGG('ALTER DATABASE [' + name + '] SET RECOVERY SIMPLE;', CHAR(13))
FROM sys.databases
WHERE name IN (
    SELECT TRIM(value)
    FROM STRING_SPLIT(@dbList, ',')
)
AND name NOT IN ('master', 'model', 'msdb', 'tempdb')
AND state_desc = 'ONLINE'
AND recovery_model_desc = 'FULL'

-- Execute generated ALTER commands
IF @sql IS NOT NULL
BEGIN
    PRINT '=== Executing Recovery Model Changes ==='
    PRINT @sql
    EXEC sp_executesql @sql
END
ELSE
BEGIN
    PRINT 'No databases require recovery model change.'
END

-- Print updated recovery models AFTER change
PRINT '=== AFTER CHANGE ==='
SELECT name AS [Database], recovery_model_desc AS [Recovery Model]
FROM sys.databases
WHERE name IN (
    SELECT TRIM(value)
    FROM STRING_SPLIT(@dbList, ',')
)
AND name NOT IN ('master', 'model', 'msdb', 'tempdb')
