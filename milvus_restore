from pymilvus import connections, Collection
import json

def restore_collection():
    connections.connect("default", host="localhost", port="19530")

    collection = Collection("my_collection")
    collection.load()

    with open("my_collection_backup.json", "r") as f:
        data = json.load(f)

    validated_data = []
    for row in data:
        if "vector" not in row:
            raise Exception(f"Missing vector field in record: {row}")

        validated_data.append({
            "id": row["id"],
            "vector": row["vector"]
        })

    batch_size = 1000

    for i in range(0, len(validated_data), batch_size):
        batch = validated_data[i:i + batch_size]
        collection.insert(batch)

    collection.flush()
    print("Restore completed successfully")

if __name__ == "__main__":
    restore_collection()
